# Copyright 2023 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: custom-dc-test
  namespace: website
spec:
  project: default

  source:
    repoURL: https://github.com/Fructokinase/website
    targetRevision: argocd
    path: deploy/helm_charts/dc_website

    helm:
      releaseName: dc-website

      values : |
        namespace:
          name: website

        website:
          githash: "1421f9a"
          image:
            project: "custom-dc-test"
            tag: "v0.1.0"
          gcpProjectID: "custom-dc-test"
          secretGCPProjectID: "custom-dc-test"
          domain: "custom-dc-test.alex-datacommons.dev"

        mixer:
          githash: "1aa6137"
          image:
            project: "datcom-ci"
            tag: "1aa6137"
          gcpProjectID: "custom-dc-test"
          serviceName: "website-esp.endpoints.custom-dc-test.cloud.goog"

        ingress:
          enabled: true

      fileParameters:
      - name: mixer.schemaConfigs."base\.mcf"
        path: ../../../mixer/deploy/mapping/base.mcf

      - name: mixer.schemaConfigs."encode\.mcf"
        path: ../../../mixer/deploy/mapping/encode.mcf

      - name: kgStoreConfig.bigqueryVersion
        path: ../../../mixer/deploy/storage/bigquery.version

      - name: kgStoreConfig.baseBigtableInfo
        path: ../../../mixer/deploy/storage/base_bigtable_info.yaml

  destination:
    server: "https://kubernetes.default.svc"
    namespace: website
